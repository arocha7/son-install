
# tasks file for docker

- name: create Docker group
  group:
    name: docker
    state: present

- name: set default username
  set_fact:
    vm_user: ubuntu
  when: ansible_distribution_release == "xenial" or ansible_distribution_release == "bionic"

- name: set default username
  set_fact:
    vm_user: centos
  when: ansible_distribution_release == "Core"

- name: add Docker group to default user
  user:
    name: "{{ vm_user }}"
    shell: /bin/bash
    groups: docker
    append: yes

- name: create a directory for Docker logging
  file:
    path: /var/log/docker
    state: directory
    owner: '{{ vm_user }}'
    group: docker
    mode: 0775

- include_tasks: "{{ ansible_distribution_release }}.yml"

- name: start Docker engine
  systemd: name=docker state=started daemon_reload=yes

- name: assure that Docker starts on boot
  service: name=docker enabled=yes

- include_tasks: "{{ lookup('env','PWD') }}/roles/docker/tasks/networks.yml"

- name: restart docker on 'systemd' systems
  systemd: name=docker state=reloaded daemon_reload=yes

