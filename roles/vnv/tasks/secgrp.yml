- name: create a new security group for SP connections
  os_security_group:
    cloud: "os_{{ pop }}_{{ proj }}"
    state: present
    name: "{{ plat }}-secgrp"
    description: SONATA SP ports

- name: create a security rule on that group to allow any SSH connection
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 22
    port_range_max: 22
    remote_ip_prefix: 0.0.0.0/0

### GTK

- name: create a security rule to allow GTK-SEC-GTW
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 80
    port_range_max: 80
    remote_ip_prefix: 0.0.0.0/0

- name: create a security rule to allow GTK-SEC-GTW
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 443
    port_range_max: 443
    remote_ip_prefix: 0.0.0.0/0

- name: create rule to provide micro-service GTK-API-GTW
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 32002
    port_range_max: 32002
    remote_ip_prefix: 0.0.0.0/0

- name: create rule to provide micro-service GTK-VNV
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 5000
    port_range_max: 5000
    remote_ip_prefix: 0.0.0.0/0

- name: create rule to provide micro-service GTK-COMMON
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 32003
    port_range_max: 32003
    remote_ip_prefix: 0.0.0.0/0
-
### REPOs

- name: create rule to provide micro-service the CATALOGUE
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 4011
    port_range_max: 4011
    remote_ip_prefix: 0.0.0.0/0

- name: create rule to provide micro-service the REPOs
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 4012
    port_range_max: 4012
    remote_ip_prefix: 0.0.0.0/0

### MANO

- name: create rule to provide micro-service LCM
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 6100
    port_range_max: 6100
    remote_ip_prefix: 0.0.0.0/0


### DB's

- name: create rule to provide micro-service MONGODB
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 27017
    port_range_max: 27017
    remote_ip_prefix: 0.0.0.0/0

# PORTAL 

- name: create rule to provide micro-service PORTAL
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 4200
    port_range_max: 4200
    remote_ip_prefix: 0.0.0.0/0

### TEST ENGINE

- name: create rule to provide micro-service TEE
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 6200
    port_range_max: 6200
    remote_ip_prefix: 0.0.0.0/0

- name: create rule to provide micro-service TNG-SDK-PKG
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "{{ plat }}-secgrp"
    protocol: tcp
    port_range_min: 5099
    port_range_max: 5099
    remote_ip_prefix: 0.0.0.0/0


