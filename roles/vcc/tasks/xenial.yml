
# FW - set Iptables configuration

#- name: install Python Firewall tools
#  package: name=python-firewall state=present

- apt: name=ufw state=present

- name: ensure the Firewall service is running
  service: name=ufw state=started enabled=yes

- name: open Squid port at firewall
  ufw:
    rule: allow
    port: 3128
    proto: tcp
  notify: reload ufw

- ufw:
    rule: allow
    port: 80
    proto: tcp
  notify: reload ufw

- ufw:
    rule: allow
    port: 443
    proto: tcp
  notify: reload ufw


# SQUID - set Squid configuration

- name: set Squid for transparent proxy
  copy:
    src: "{{ lookup('env','PWD') }}/roles/{{ plat }}/files/squid.conf"
    dest: /etc/squid/squid.conf
    owner: root
    group: root
    mode: 0644


- name: start PROXY service
  service: name=squid state=started enabled=yes
