---
# tasks file for squid

- name: installing SQUID proxy server
  package:
    name: squid
    state: latest
# include: "{{ ansible_os_family }}.yml"

# preserve original config file
- fetch: 
    src: /etc/squid/squid.conf
    dest: /tmp/squid.conf
    flat: yes
  when: ansible_distribution_release == "Core" or ansible_distribution_release == "xenial"
- copy:
    src: /tmp/squid.conf
    dest: /etc/squid/squid.conf.ORIG
    owner: root
    group: root
    mode: 0640
  when: ansible_distribution_release == "Core" or ansible_distribution_release == "xenial"

- fetch:
    src: /etc/squid3/squid.conf
    dest: /tmp/squid.conf
    flat: yes
  when: ansible_distribution_release == "trusty"
- copy:
    src: /tmp/squid.conf
    dest: /etc/squid3/squid.conf.ORIG
    owner: root
    group: root
    mode: 0640
  when: ansible_distribution_release == "trusty"

- name: start SQUID service
  service: name=squid state=started enabled=yes
  when: ansible_distribution_release == "Core" or ansible_distribution_release == "xenial"

- name: start SQUID service
  service: name=squid3 state=started enabled=yes
  when: ansible_distribution_release == "trusty"

- command: squid -v
  register: squidver

- name: echo SQUID installed version
  debug: 
    msg: "{{ squidver }}"
