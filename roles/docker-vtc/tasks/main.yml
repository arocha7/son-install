---
# tasks file for docker-vtc

- name: Docker User Defined Network (vTC INGRESS)
  shell: 'docker network create --driver=bridge \
--subnet=172.21.113.0/24 --gateway=172.21.113.1 \
--ip-range=172.21.113.128/25 "{{ docker_vtc_in }}"'

- name: Docker User Defined Network (vTC OUTGRESS)
  shell: 'docker network create --driver=bridge \
--subnet=172.21.114.0/24 --gateway=172.21.114.1 \
--ip-range=172.21.114.128/25 "{{ docker_vtc_out }}"'


- name: start vTC Docker container
  docker_container:

    name: vtc
    image: sonatanfv/sonata-vtc-vnf
    #env:
    state: started
    network_mode: bridge
    networks:
      - name: "{{ docker_network_name }}"
        aliases:
          - son-mgmt
      - name: "{{ docker_vtc_in }}"
        aliases:
          - son-vtc-in
      - name: "{{ docker_vtc_out }}"
        aliases:
          - son-vtc-out
    published_ports: 0:0
    volumes:
      - /var/log/sonata/vtc:/var/log/vtc

#- wait_for: host=0.0.0.0 port=389 timeout=30 delay=10 state=started

