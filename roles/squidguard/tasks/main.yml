# tasks file for squidguard
---

- file:
    path: "/usr/local/squidGuard/db"
    state: directory
    mode: 0755

- name: get MESD BlackList (freely available) for SquidGuard
  get_url:
    url: "http://squidguard.mesd.k12.or.us/blacklists.tgz"
    dest: "/tmp"

- name: unarchiving BlackList tarball
  unarchive:
    src: "/tmp/blacklists.tgz"
    dest: "/usr/local/squidGuard/db"
    remote_src: true

- file:
    path: "/usr/local/BerkeleyDB"
    state: directory
    mode: 0755

- name: get Berkeley BlackList (freely available from Oracle) for SquidGuard
  get_url:
    #url: "http://download.oracle.com/otn/berkeley-db/db-6.2.32.tar.gz"
    url: "http://files.sonata-nfv.eu/son-psa-pilot/prx-vnf/db-6.2.32.tar.gz"
    dest: "/tmp"
    url_username: "{{ son-files-usr }}"
    url_password: "{{ son-files-pwd }}"


- name: unarchiving BlackList tarball
  unarchive:
    src: "/tmp/db-6.2.32.tar.gz"
    dest: "/usr/local/BerkeleyDB"
    remote_src: true

- copy:
    src: "/usr/local/BerkeleyDB/db-6.2.32/"
    dest: "/usr/local/BerkeleyDB"
    recursive: true
    remote_src: true
    delete: False


- name: get SquidGuard (URL redirector used to use blacklists with the Proxy software) 
  get_url:
    url: "http://www.squidguard.org/Downloads/squidGuard-1.4.tar.gz"
    dest: "/tmp"
#  register: new_archive

- name: install SquidGuard 1.4
  shell: cd /tmp/squidGuard-1.4 && ./configure && make && make install


#- name: install SquidGuard
#  pip: name='file:///tmp/squidGuard-1.4.tar.gz' state=present
#  when: new_archive|changed

