- name: create a new security group for SSH connections
  os_security_group:
    cloud: "os_{{ pop }}_{{ proj }}"
    state: present
    name: "sp-secgrp"
    description: open SSH port

- name: create a security rule on that group to allow any SSH connection
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "ssh-secgrp"
    protocol: tcp
    port_range_min: 22
    port_range_max: 22
    remote_ip_prefix: 0.0.0.0/0

### QCOW2 VM based

- name: create a new security group for vPSA connections
  os_security_group:
    cloud: "os_{{ pop }}_{{ proj }}"
    state: present
    name: "vpsa-secgrp"
    description: open vPSA ports

- name: create a security rule on that group to allow connections to vPSA
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "vpsa-secgrp"
    protocol: tcp
    port_range_min: 80
    port_range_max: 80
    remote_ip_prefix: 0.0.0.0/0


### Docker container based

- name: create a new security group for vPSA connections
  os_security_group:
    cloud: "os_{{ pop }}_{{ proj }}"
    state: present
    name: "docker-vpsa-secgrp"
    description: open vPSA ports

- name: create a security rule on that group to allow connections to vPSA
  os_security_group_rule:
    cloud: "os_{{ pop }}_{{ proj }}"
    security_group: "docker-vpsa-secgrp"
    protocol: tcp
    port_range_min: 80
    port_range_max: 80
    remote_ip_prefix: 0.0.0.0/0

