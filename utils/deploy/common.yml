---

- name: SONATA CMUD v3.1 - upgrade Operating System packages and install useful tools
  hosts: "{{ plat | default('localhost') }}"
  become: true
  connection: ssh
  remote_user: "{{ vm_user | default('sonata') }}"
  vars:
    localhome: "{{ lookup('env','PWD') }}"
    distro: '{{ ansible_distribution_release }}'
  roles:
    - common
  tasks:

    - name: Wait 300 seconds for port 22 to become open and contain "OpenSSH"
      wait_for:
        port: 22
        host: '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}'
        search_regex: OpenSSH
        delay: 10
      vars:
        ansible_connection: local
